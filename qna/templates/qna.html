{% extends 'base.html' %}

{% block content %}

<head>
    <script>
        $(document).ready(function () {
            loadData();

            $('#add-question').click(function () {
                $.post(
                    '/qna/add/',
                    {
                        text: $('#text').val(),
                    },
                    function (data, status) {
                        if (status == 'success') {
                            $(`#quest`).append(questionCard(data))
                            $('#text').val('')
                        }
                    },
                )
            })
        });

        function deleteQuestion(id) {
            $.ajax({
                url: `/qna/delete/${id}`,
                type: 'DELETE',
                success: function (result) {
                    $(`#quest-${id}`).remove()
                },
                error: function (result){
                    alert("Tidak dapat menghapus post orang lain!")
                }
            });
        }

        function deleteAnswer(id) {
            $.ajax({
                url: `/qna/delete2/${id}`,
                type: 'DELETE',
                success: function (result) {
                    $(`#answer-${id}`).remove()
                },
                error: function (result){
                    alert("Tidak dapat menghapus post orang lain!")
                }
            });
        }

        function addAnswer(id) {
            $.post(
                `/qna/answer/${id}`,
                {
                    text: $(`#input-answer-${id}`).val(),
                },
                function (data, status) {
                    if (status == 'success') {
                        $(`#quest-answers-${id}`).append(answerCard(data))
                        $(`#no-answer-${id}`).remove()
                        $(`#input-answer-${id}`).val('')
                    }
                },
            )
        }

        function updateCard(id) {
            $.ajax({
                url: `/todolist/update/${id}`,
                type: 'PATCH',
                success: function (data) {
                    $(`#task-${id}`).empty()
                    $(`#task-${id}`).append(
                        `<div class="rounded-3xl bg-gradient-to-r from-blue-100 ${data.fields.is_finished ? `to-green-600` : `to-rose-600`} p-4">
                            <div class="flex justify-between">
                                <span class="text-xs">${data.fields.date}</span>
                                <ion-icon name="trash-outline" id="delete-icon" onclick="deleteQuestion(${data.pk})"></ion-icon>
                            </div>
                            <div class="flex justify-between">
                                <span class="font-bold text-lg">${data.fields.title}</span>
                            </div>
                            <p>${data.fields.description}</p>
                            <div class="flex justify-center mt-6">
                                <ion-icon name=${data.fields.is_finished ? 'checkmark-outline' : 'close-outline'} onclick="updateCard(${data.pk})"></ion-icon>
                            </div>
                        </div>`
                    )
                }
            });
        }

        const questionCard = (data) =>
            `<div class="flex" id="quest-${data.pk}">
                <div class="flex-shrink-0 mr-3">
                    <img class="mt-2 rounded-full w-8 h-8 sm:w-10 sm:h-10" src="https://cdn-icons-png.flaticon.com/512/709/709722.png" alt="">
                </div>
                <div class="flex-1 border rounded-lg px-4 py-2 sm:px-6 sm:py-4 leading-relaxed">
                    <div class="flex justify-between">
                        <span class="text-xs text-gray-400 mt-0">${data.fields.date}</span>
                        <ion-icon name="trash-outline" id="delete-icon" class="cursor-pointer" onclick="deleteQuestion(${data.pk})"></ion-icon>
                    </div>
                    <strong>${data.fields.user}</strong>
                    <p class="text-sm">${data.fields.text}</p>

                    <div class="flex justify-between items-center">
                        <form action="" method="POST" class="w-full">
                            {% csrf_token %}
                            {% if user.is_authenticated %}
                            <input type="text" name="title" id="input-answer-${data.pk}"
                            class="form-control bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2 my-3"
                            placeholder="Jawab di sini">
                            {% else %}
                            <input type="text" name="title" id="input-answer-${data.pk}" aria-label="disabled input"
                            class="form-control bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2 my-3"
                            placeholder="Login untuk menjawab" disabled>
                            {% endif %}
                        </form>
                    
                        {% if user.is_authenticated %}
                        <button type="submit" class="ml-1 inline-flex justify-center p-2 text-blue-600 rounded-full cursor-pointer hover:bg-blue-100" onclick="addAnswer(${data.pk})">
                            <svg aria-hidden="true" class="w-6 h-6 rotate-90" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"></path></svg>
                        </button>
                        {% endif %}
                    </div>
                    
                    <h4 class="my-5 uppercase tracking-wide text-gray-400 font-bold text-xs">Answers</h4>

                    ${ data.fields.is_answered ? '' : `<h6 class="text-sm" id='no-answer-${data.pk}''>No answer yet.</h6>`}

                    <div class="space-y-4" id='quest-answers-${data.pk}'></div>
            
                </div>
            </div>`
        
        const answerCard = (data) =>
            `<div class="flex" id='answer-${data.pk}'>
                <div class="flex-shrink-0 mr-3">
                    <img class="mt-3 rounded-full w-6 h-6 sm:w-8 sm:h-8"
                        src="https://cdn-icons-png.flaticon.com/512/709/709722.png" alt="">
                </div>
                <div class="flex-1 bg-gray-100 rounded-lg px-4 py-2 sm:px-6 sm:py-4 leading-relaxed">
                    <div class="flex justify-between">
                        <span class="text-xs text-gray-400">${data.fields.date}</span>
                        <ion-icon name="trash-outline" id="delete-icon" class="cursor-pointer" onclick="deleteAnswer(${data.pk})"></ion-icon>
                    </div>
                    <strong>${data.fields.user}</strong> 
                    <p class="text-xs sm:text-sm">${data.fields.text}</p>
                </div>
            </div>`

        function loadData() {
            $.get(`/qna/json`, function (data) {
                for (var i = 0; i < data.length; i++) {
                    $(`#quest`).append(questionCard(data[i]));
                }
            });
            $.get(`/qna/json2`, function (data) {
                for (var i = 0; i < data.length; i++) {
                    $(`#quest-answers-${data[i].fields.question}`).append(answerCard(data[i]));
                }
            });
        }
    </script>
</head>

<button onclick="buttonHandler()" type="button" data-bs-toggle="modal" data-bs-target="#exampleModalCenter"
    class="fixed z-90 bottom-10 right-8 bg-[#FF8FB1] w-40 h-12 rounded-full drop-shadow-lg flex justify-center items-center text-white text-4xl hover:bg-[#7A4495] hover:drop-shadow-2xl hover:animate-bounce duration-300">
    <svg viewBox="0 0 20 20" enable-background="new 0 0 20 20" class="w-6 h-6 inline-block">
        <path fill="#FFFFFF" d="M16,10c0,0.553-0.048,1-0.601,1H11v4.399C11,15.951,10.553,16,10,16c-0.553,0-1-0.049-1-0.601V11H4.601
                                    C4.049,11,4,10.553,4,10c0-0.553,0.049-1,0.601-1H9V4.601C9,4.048,9.447,4,10,4c0.553,0,1,0.048,1,0.601V9h4.399
                                    C15.952,9,16,9.447,16,10z" />
    </svg>
    <span class="text-xs font-bold">Tambah Pertanyaan</span>
</button>

<!-- modal -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content create-task rounded-2xl shadow-lg max-w-3xl p-5 bg-[#FF8FB1]">
            <div class="modal-header">
                <h5 class="modal-title text-white font-bold text-xl" id="exampleModalLongTitle">Tambah Pertanyaan</h5>
                <button type="button" class="close co" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form action="" method="POST" class="">
                    {% csrf_token %}
                    <textarea
                    class="block p-4 w-full text-gray-900 bg-gray-50 rounded-lg border border-gray-300 sm:text-md focus:ring-blue-500 focus:border-blue-500 
                    form-control px-3 py-1.5 text-base font-normal bg-clip-padding border-solid transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:outline-none"
                    id="text" rows="3" placeholder="Apa pertanyaanmu?"></textarea>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="add-question">Add</button>
            </div>
        </div>
    </div>
</div>

<div class="antialiased mx-auto max-w-screen-sm">
    <h3 class="mb-4 text-lg font-semibold text-gray-900">TanyaBund</h3>

    <div class="space-y-4" id="quest">

        <!-- <div class="flex">
            <div class="flex-shrink-0 mr-3">
                <img class="mt-2 rounded-full w-8 h-8 sm:w-10 sm:h-10"
                    src="https://cdn-icons-png.flaticon.com/512/709/709722.png" alt="">
            </div>
            <div class="flex-1 border rounded-lg px-4 py-2 sm:px-6 sm:py-4 leading-relaxed">
                <div class="flex justify-between">
                    <strong>Sarah</strong> <span class="text-xs text-gray-400">3:34 PM</span>
                </div>
                <p class="text-sm">
                    Lorem ipsum dolor sit amet, consetetur sadipscing elitr,
                    sed diam nonumy eirmod tempor invidunt ut labore et dolore
                    magna aliquyam erat, sed diam voluptua.
                </p>

                <div class="flex justify-between items-center">
                    <form action="" method="POST" class="w-full">
                        {% csrf_token %}
                        <input type="text" name="title" maxlength="150" id="input-answer-${data.pk}"
                            class="form-control bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2 my-3"
                            placeholder="Jawab di sini">
                    </form>

                    <button type="submit"
                        class="ml-1 inline-flex justify-center p-2 text-blue-600 rounded-full cursor-pointer hover:bg-blue-100">
                        <svg aria-hidden="true" class="w-6 h-6 rotate-90" fill="currentColor" viewBox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z">
                            </path>
                        </svg>
                    </button>
                </div>

                <h4 class="my-5 uppercase tracking-wide text-gray-400 font-bold text-xs">Answers</h4>

                <div class="space-y-4">
                    <div class="flex">
                        <div class="flex-shrink-0 mr-3">
                            <img class="mt-3 rounded-full w-6 h-6 sm:w-8 sm:h-8"
                                src="https://cdn-icons-png.flaticon.com/512/709/709722.png" alt="">
                        </div>
                        <div class="flex-1 bg-gray-100 rounded-lg px-4 py-2 sm:px-6 sm:py-4 leading-relaxed">
                            <div class="flex justify-between">
                                <strong>Sarah</strong> <span class="text-xs text-gray-400">3:34 PM</span>
                            </div>
                            <p class="text-xs sm:text-sm">
                                Lorem ipsum dolor sit amet, consetetur sadipscing elitr,
                                sed diam nonumy eirmod tempor invidunt ut labore et dolore
                                magna aliquyam erat, sed diam voluptua.
                            </p>
                        </div>
                    </div>
                    <div class="flex">
                        <div class="flex-shrink-0 mr-3">
                            <img class="mt-3 rounded-full w-6 h-6 sm:w-8 sm:h-8"
                                src="https://cdn-icons-png.flaticon.com/512/709/709722.png" alt="">
                        </div>
                        <div class="flex-1 bg-gray-100 rounded-lg px-4 py-2 sm:px-6 sm:py-4 leading-relaxed">
                            <div class="flex justify-between">
                                <strong>Sarah</strong> <span class="text-xs text-gray-400">3:34 PM</span>
                            </div>
                            <p class="text-xs sm:text-sm">
                                Lorem ipsum dolor sit amet, consetetur sadipscing elitr,
                                sed diam nonumy eirmod tempor invidunt ut labore et dolore
                                magna aliquyam erat, sed diam voluptua.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex">
            <div class="flex-shrink-0 mr-3">
                <img class="mt-2 rounded-full w-8 h-8 sm:w-10 sm:h-10"
                    src="https://cdn-icons-png.flaticon.com/512/709/709722.png" alt="">
            </div>
            <div class="flex-1 border rounded-lg px-4 py-2 sm:px-6 sm:py-4 leading-relaxed">
                <div class="flex justify-between">
                    <strong>Sarah</strong> <span class="text-xs text-gray-400">3:34 PM</span>
                </div>
                <p class="text-sm">
                    Lorem ipsum dolor sit amet, consetetur sadipscing elitr,
                    sed diam nonumy eirmod tempor invidunt ut labore et dolore
                    magna aliquyam erat, sed diam voluptua.
                </p>

                <input type="text" name="title" maxlength="150" id="title"
                    class="form-control bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2 my-3"
                    placeholder="Jawab di sini">

                <h4 class="my-5 uppercase tracking-wide text-gray-400 font-bold text-xs">Answers</h4>

                <div class="space-y-4">
                    <div class="flex">
                        <div class="flex-shrink-0 mr-3">
                            <img class="mt-3 rounded-full w-6 h-6 sm:w-8 sm:h-8"
                                src="https://cdn-icons-png.flaticon.com/512/709/709722.png" alt="">
                        </div>
                        <div class="flex-1 bg-gray-100 rounded-lg px-4 py-2 sm:px-6 sm:py-4 leading-relaxed">
                            <div class="flex justify-between">
                                <strong>Sarah</strong> <span class="text-xs text-gray-400">3:34 PM</span>
                            </div>
                            <p class="text-xs sm:text-sm">
                                Lorem ipsum dolor sit amet, consetetur sadipscing elitr,
                                sed diam nonumy eirmod tempor invidunt ut labore et dolore
                                magna aliquyam erat, sed diam voluptua.
                            </p>
                        </div>
                    </div>
                    <div class="flex">
                        <div class="flex-shrink-0 mr-3">
                            <img class="mt-3 rounded-full w-6 h-6 sm:w-8 sm:h-8"
                                src="https://cdn-icons-png.flaticon.com/512/709/709722.png" alt="">
                        </div>
                        <div class="flex-1 bg-gray-100 rounded-lg px-4 py-2 sm:px-6 sm:py-4 leading-relaxed">
                            <div class="flex justify-between">
                                <strong>Sarah</strong> <span class="text-xs text-gray-400">3:34 PM</span>
                            </div>
                            <p class="text-xs sm:text-sm">
                                Lorem ipsum dolor sit amet, consetetur sadipscing elitr,
                                sed diam nonumy eirmod tempor invidunt ut labore et dolore
                                magna aliquyam erat, sed diam voluptua.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>-->

        <div class="flex">
            <div class="flex-shrink-0 mr-3">
                <img class="mt-2 rounded-full w-8 h-8 sm:w-10 sm:h-10"
                    src="https://cdn-icons-png.flaticon.com/512/709/709722.png" alt="">
            </div>
            <div class="flex-1 border rounded-lg px-4 py-2 sm:px-6 sm:py-4 leading-relaxed">
                <div class="flex justify-between">
                    <div class="">
                        <span class="text-xs text-gray-400">22/10/2022</span>
                    </div>
                    <ion-icon name="trash-outline" id="delete-icon" class="cursor-pointer" onclick="deleteQuestion()"></ion-icon>
                </div>
                <strong>Fadhlan</strong>
                <p class="text-sm">
                    Lorem ipsum dolor sit amet, consetetur sadipscing elitr,
                    sed diam nonumy eirmod tempor invidunt ut labore et dolore
                    magna aliquyam erat, sed diam voluptua.
                </p>

                <input type="text" name="title" maxlength="150" id="title"
                    class="form-control bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2 my-3"
                    placeholder="Jawab di sini">

                <h4 class="my-5 uppercase tracking-wide text-gray-400 font-bold text-xs">Answers</h4>
                <h6 class="text-sm">No answer yet.</h6>
            </div>
        </div>

    </div>
</div>
{% endblock content %}